<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/styleFeed.css">
    <title>Sofrosina | Feed</title>
</head>
<body onload="carregarPosts()">
    <header>
        <nav class="navbar">
            <h3 class="logo"><a href="index.html">Sofrosina</a></h3>
            <ul class="nav-list">
                <li><h4><a href="post.html">Post</a></h4></li>
                <li><h4><a href="feed.html">Feed</a></h4></li>
                <li><h4><a href="conta.html">Conta</a></h4></li>
            </ul>
        </nav>
    </header>

    <main class="feed" id="feed">
    </main>
</body>
</html>

<script>
    function carregarPosts() {
        fetch("/post/carregarPosts").then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var feed = document.getElementById("feed");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    feed.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var feed = document.getElementById("feed");
                    feed.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];

                        var sectionPost = document.createElement("section");
                        var articleTop = document.createElement("article");
                        var h4Titulo = document.createElement("h4");
                        var spanLike = document.createElement("span");
                        var pText = document.createElement("p");
                        var articleBottom = document.createElement("article");
                        var infoPost = document.createElement("small");
                        var smallData = document.createElement("small");

                        var data = publicacao.dataPost.split('-'); // ['2024', '11', '21']

                        h4Titulo.innerHTML = `${publicacao.titulo}`;
                        spanLike.innerHTML = `${publicacao.contagemLike} <a onclick="darLike()"><img src="assets/heart.svg"></a>`;
                        pText.innerHTML = `${publicacao.texto}`;
                        infoPost.innerHTML = `Escrito por <span class="author">${publicacao.nomeUsuario}</span>`;
                        smallData.innerHTML = `${data[2]}/${data[1]}/${data[0]}`;

                        sectionPost.className = `post`;
                        articleTop.className = `top`;
                        h4Titulo.className = `title`;
                        spanLike.className = `likes`;
                        pText.className = `text`;
                        articleBottom.className = `bottom`;
                        infoPost.className = `write-by`;
                        smallData.className = `date-post`;

                        sectionPost.appendChild(articleTop);
                        sectionPost.appendChild(pText);
                        sectionPost.appendChild(articleBottom);
                        articleTop.appendChild(h4Titulo);
                        articleTop.appendChild(spanLike);
                        articleBottom.appendChild(infoPost);
                        articleBottom.appendChild(smallData);
                        feed.appendChild(sectionPost);
                    }
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
        });
    }
</script>